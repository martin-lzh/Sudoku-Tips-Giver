<!--
Sudoku Tips Giver
Copyright (c) 2025 Sudoku Tips Giver

A web application that helps users solve Sudoku puzzles with intelligent hints.
-->

<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°ç‹¬æç¤ºå™¨ | Sudoku Tips Giver</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ²</text></svg>">
    <style>
        :root {
            /* åŸºç¡€å°ºå¯¸å˜é‡ */
            --vh: 1vh;
            --vw: 1vw;
            --min-cell-size: 30px;
            --max-cell-size: 50px;
            --header-height: 60px;
            --controls-height: 180px;
            --grid-padding: 10px;
            
            /* åŠ¨æ€è®¡ç®—ç½‘æ ¼å°ºå¯¸ */
            --available-height: calc(100vh - var(--header-height) - var(--controls-height));
            --available-width: calc(100vw - 40px);
            --cell-size: clamp(
                var(--min-cell-size),
                min(
                    calc((var(--available-height) - var(--grid-padding) * 2) / 9),
                    calc((var(--available-width) - var(--grid-padding) * 2) / 9)
                ),
                var(--max-cell-size)
            );
            
            /* é¢œè‰²å˜é‡ - æ˜äº®ä¸»é¢˜ */
            --bg-color: #f0f0f0;
            --container-bg: white;
            --text-color: #333;
            --cell-bg: white;
            --cell-border: #999;
            --grid-border: #333;
            --grid-bg: #ffffff;
            --highlight-bg: rgba(76, 175, 80, 0.5);
            --button-bg: #4CAF50;
            --button-hover: #45a049;
            --button-text: #ffffff;
            --success-bg: #e6ffe6;
            --success-color: #28a745;
            --error-bg: #ffe6e6;
            --error-color: #dc3545;
            --highlight-color: #4CAF50;
            --draft-color: #999999;
            --draft-color-dark: #666666;
        }

        [data-theme="dark"] {
            --bg-color: #222;
            --container-bg: #333;
            --text-color: #fff;
            --cell-bg: #444;
            --cell-border: #666;
            --grid-border: #888;
            --grid-bg: #333;
            --highlight-bg: rgba(102, 187, 106, 0.5);
            --button-bg: #66bb6a;
            --button-hover: #81c784;
            --button-text: #ffffff;
            --success-bg: #143322;
            --success-color: #28a745;
            --error-bg: #331111;
            --error-color: #dc3545;
            --highlight-color: #66bb6a;
            --draft-color: #666666;
            --draft-color-dark: #999999;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: calc(var(--cell-size) * 0.5);
        }

        h1 {
            margin: calc(var(--cell-size) * 0.5) 0;
            font-size: calc(var(--cell-size) * 0.6);
            word-wrap: break-word;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .controls {
            margin-bottom: calc(var(--cell-size) * 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: calc(var(--cell-size) * 0.3);
            width: 100%;
            max-width: calc(var(--cell-size) * 12);
            height: var(--controls-height);
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: calc(var(--cell-size) * 0.2);
            width: 100%;
        }

        select, button {
            padding: calc(var(--cell-size) * 0.2) calc(var(--cell-size) * 0.4);
            font-size: calc(var(--cell-size) * 0.35);
            min-width: calc(var(--cell-size) * 2.5);
            height: calc(var(--cell-size) * 0.8);
            border: none;
            border-radius: 4px;
            background-color: var(--button-bg);
            color: var(--button-text);
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        select {
            background-color: var(--container-bg);
            color: var(--text-color);
            border: 1px solid var(--button-bg);
        }

        button:hover {
            background-color: var(--button-hover);
        }

        .grid {
            display: inline-block;
            background-color: var(--grid-bg);
            padding: var(--grid-padding);
            border-radius: calc(var(--cell-size) * 0.2);
            margin: 0 auto;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .row {
            display: flex;
            justify-content: center;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            border: 1px solid var(--cell-border);
            position: relative;
            transition: all 0.3s ease;
            background-color: var(--cell-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cell.highlight, .cell.highlighted {
            background-color: var(--highlight-bg);
        }

        .cell .main-number {
            font-size: calc(var(--cell-size) * 0.5);
            color: var(--text-color);
            z-index: 2;
        }

        .cell .draft-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            width: 100%;
            height: 100%;
            z-index: 1;
            position: absolute;
            top: 0;
            left: 0;
            padding: 2px;
            box-sizing: border-box;
        }

        .cell .draft-number {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: calc(var(--cell-size) * 0.3);
            color: var(--draft-color);
            width: 100%;
            height: 100%;
        }

        [data-theme="dark"] .cell .draft-number {
            color: var(--draft-color-dark);
        }

        .draft-mode .cell {
            cursor: crosshair;
        }

        .theme-toggle, .lang-toggle, .help-button {
            position: fixed;
            top: calc(var(--cell-size) * 0.2);
            height: calc(var(--cell-size) * 0.8);
            font-size: calc(var(--cell-size) * 0.35);
            min-width: auto;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .theme-toggle:hover, .lang-toggle:hover, .help-button:hover {
            background-color: var(--button-hover);
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        .help-button {
            right: calc(var(--cell-size) * 0.2);
            width: calc(var(--cell-size) * 0.8);
        }

        .lang-toggle {
            right: calc(var(--cell-size) * 1.2);
            width: calc(var(--cell-size) * 1.3);
        }

        .theme-toggle {
            right: calc(var(--cell-size) * 2.7);
            width: calc(var(--cell-size) * 0.8);
        }

        .draft-toggle {
            position: fixed;
            top: calc(var(--cell-size) * 0.2);
            right: calc(var(--cell-size) * 3.7);
            width: calc(var(--cell-size) * 0.8);
            height: calc(var(--cell-size) * 0.8);
            min-width: unset;
            padding: 0;
            background-color: var(--button-bg);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .draft-toggle.active {
            background-color: var(--button-bg);
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        @media screen and (max-width: 600px) {
            :root {
                --min-cell-size: 25px;
                --header-height: 50px;
                --controls-height: 160px;
            }

            body {
                padding: 10px;
            }

            h1 {
                font-size: calc(var(--cell-size) * 0.7);
            }

            select, button {
                padding: calc(var(--cell-size) * 0.15) calc(var(--cell-size) * 0.3);
                font-size: calc(var(--cell-size) * 0.4);
                min-width: calc(var(--cell-size) * 2);
            }
        }

        @media screen and (max-width: 360px) {
            :root {
                --min-cell-size: 20px;
                --header-height: 40px;
                --controls-height: 140px;
            }

            body {
                padding: 5px;
            }

            .buttons {
                gap: calc(var(--cell-size) * 0.15);
            }
        }

        .loading-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(3px);
            z-index: 10;
            justify-content: center;
            align-items: center;
        }

        [data-theme="dark"] .loading-overlay {
            background-color: rgba(0, 0, 0, 0.8);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--button-bg);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        .button-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .cell input:disabled {
            color: var(--text-color);
            opacity: 0.7;
            cursor: not-allowed;
            background: transparent;
            caret-color: transparent;  /* éšè—å…‰æ ‡ */
        }

        .cell input.initial {
            font-weight: bold;
            color: var(--text-color);
        }

        .cell input:not(:disabled):focus {
            outline: 2px solid var(--button-bg);
        }

        .grid-line-right {
            border-right: 2px solid var(--grid-border) !important;
        }

        .grid-line-bottom {
            border-bottom: 2px solid var(--grid-border) !important;
        }

        .message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            min-height: 50px;
        }

        .error {
            background-color: var(--error-bg);
            color: var(--error-color);
        }

        .success {
            background-color: var(--success-bg);
            color: var(--success-color);
        }

        .buttons select {
            font-size: 14px;
            border: 1px solid var(--button-bg);
            border-radius: 5px;
            background-color: var(--cell-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .buttons select:hover {
            border-color: var(--button-hover);
        }

        .buttons select option {
            background-color: var(--container-bg);
            color: var(--text-color);
        }

        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .help-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--container-bg);
            color: var(--text-color);
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-help {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }

        .help-content h2 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--text-color);
        }

        .help-content h3 {
            margin-top: 20px;
            color: var(--button-bg);
        }

        .help-content ul {
            padding-left: 20px;
        }

        .help-content li {
            margin: 10px 0;
        }

        .cell.selected {
            background-color: var(--highlight-bg);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-controls">
            <h1 class="lang-zh">æ•°ç‹¬æç¤ºå™¨</h1>
            <h1 class="lang-en" style="display: none;">Sudoku Tips Giver</h1>
            <div class="control-buttons">
                <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
                <button class="lang-toggle" onclick="toggleLanguage()">ä¸­/En</button>
                <button class="help-button" onclick="toggleHelp()">?</button>
                <button class="draft-toggle" id="draftToggle">âœ</button>
            </div>
        </div>
        <div class="buttons">
            <select id="difficulty" class="lang-zh">
                <option value="easy">ç®€å•</option>
                <option value="medium" selected>ä¸­ç­‰</option>
                <option value="hard">å›°éš¾</option>
            </select>
            <select id="difficulty-en" class="lang-en" style="display: none;">
                <option value="easy">Easy</option>
                <option value="medium" selected>Medium</option>
                <option value="hard">Hard</option>
            </select>
            <button onclick="generateSudoku()" class="lang-zh">ç”Ÿæˆæ•°ç‹¬</button>
            <button onclick="getHint()" class="lang-zh">è·å–æç¤º</button>
            <button onclick="showAnswer()" class="lang-zh">æ˜¾ç¤ºç­”æ¡ˆ</button>
            <button onclick="clearBoard()" class="lang-zh">æ¸…ç©ºæ£‹ç›˜</button>
            <button onclick="generateSudoku()" class="lang-en" style="display: none;">Generate Sudoku</button>
            <button onclick="getHint()" class="lang-en" style="display: none;">Get Hint</button>
            <button onclick="showAnswer()" class="lang-en" style="display: none;">Show Answer</button>
            <button onclick="clearBoard()" class="lang-en" style="display: none;">Clear Board</button>
        </div>
        <div class="grid" id="grid">
            <div class="loading-overlay" id="gridLoading" style="display: none;">
                <div class="loading-spinner"></div>
            </div>
            {% for i in range(9) %}
            <div class="row">
                {% for j in range(9) %}
                <div class="cell{% if j == 2 or j == 5 %} grid-line-right{% endif %}{% if i == 2 or i == 5 %} grid-line-bottom{% endif %}" data-row="{{ i }}" data-col="{{ j }}">
                    <div class="main-number"></div>
                    <div class="draft-grid">
                        {% for n in range(9) %}
                        <div class="draft-number"></div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
        <div class="message" id="message"></div>
    </div>

    <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <span class="close-help" onclick="toggleHelp()">&times;</span>
            <div class="lang-zh">
                <h2>ä½¿ç”¨å¸®åŠ©</h2>
                
                <h3>éš¾åº¦çº§åˆ«</h3>
                <ul>
                    <li><strong>ç®€å•</strong>ï¼šåˆå§‹æ•°å­— 35-40 ä¸ªï¼Œé€‚åˆåˆå­¦è€…</li>
                    <li><strong>ä¸­ç­‰</strong>ï¼šåˆå§‹æ•°å­— 25-30 ä¸ªï¼Œéœ€è¦ä¸€å®šè§£é¢˜æŠ€å·§</li>
                    <li><strong>å›°éš¾</strong>ï¼šåˆå§‹æ•°å­— 20-25 ä¸ªï¼Œå¯Œæœ‰æŒ‘æˆ˜æ€§</li>
                </ul>

                <h3>æŒ‰é’®åŠŸèƒ½</h3>
                <ul>
                    <li><strong>ç”Ÿæˆæ•°ç‹¬</strong>ï¼šæ ¹æ®é€‰æ‹©çš„éš¾åº¦ç”Ÿæˆæ–°çš„æ•°ç‹¬é¢˜ç›®</li>
                    <li><strong>è·å–æç¤º</strong>ï¼šé«˜äº®æ˜¾ç¤ºæœ€é€‚åˆå¡«å†™çš„æ ¼å­ï¼Œå¹¶æä¾›å¯èƒ½çš„æ•°å­—</li>
                    <li><strong>æ˜¾ç¤ºç­”æ¡ˆ</strong>ï¼šåœ¨é«˜äº®æ ¼å­ä¸­å¡«å…¥æ­£ç¡®ç­”æ¡ˆ</li>
                    <li><strong>æ¸…ç©ºæ£‹ç›˜</strong>ï¼šæ¸…é™¤æ‰€æœ‰å·²å¡«å†™çš„æ•°å­—ï¼Œé‡æ–°å¼€å§‹</li>
                </ul>

                <h3>æ“ä½œè¯´æ˜</h3>
                <ul>
                    <li>ä½¿ç”¨é¼ æ ‡ç‚¹å‡»æ ¼å­æˆ–é”®ç›˜æ–¹å‘é”®è¿›è¡Œå¯¼èˆª</li>
                    <li>ç›´æ¥è¾“å…¥æ•°å­— 1-9</li>
                    <li>æŒ‰é€€æ ¼é”®æ¸…é™¤å½“å‰æ ¼å­</li>
                    <li>ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥æ˜¯å¦å®Œæˆ</li>
                </ul>

                <h3>è‰ç¨¿åŠŸèƒ½</h3>
                <ul>
                    <li><strong>âœ</strong>ï¼šç‚¹å‡»åˆ‡æ¢è‰ç¨¿æ¨¡å¼</li>
                    <li>åœ¨è‰ç¨¿æ¨¡å¼ä¸‹ï¼Œå¯ä»¥åœ¨æ ¼å­ä¸­æ·»åŠ å¤šä¸ªå€™é€‰æ•°å­—</li>
                    <li>å†æ¬¡ç‚¹å‡»è‰ç¨¿æŒ‰é’®å¯é€€å‡ºè‰ç¨¿æ¨¡å¼</li>
                    <li>è‰ç¨¿æ•°å­—ä¸ä¼šå½±å“æ¸¸æˆåˆ¤å®š</li>
                </ul>

                <h3>ç•Œé¢æ§åˆ¶</h3>
                <ul>
                    <li>ğŸŒ“ï¼šåˆ‡æ¢æ·±è‰²/æµ…è‰²ä¸»é¢˜</li>
                    <li>ä¸­/Enï¼šåˆ‡æ¢ä¸­æ–‡/è‹±æ–‡ç•Œé¢</li>
                    <li>?ï¼šæ˜¾ç¤º/éšè—å¸®åŠ©ä¿¡æ¯</li>
                    <li>âœï¼šåˆ‡æ¢è‰ç¨¿æ¨¡å¼</li>
                </ul>
            </div>
            <div class="lang-en" style="display: none;">
                <h2>Help Guide</h2>
                
                <h3>Difficulty Levels</h3>
                <ul>
                    <li><strong>Easy</strong>: 35-40 initial numbers, suitable for beginners</li>
                    <li><strong>Medium</strong>: 25-30 initial numbers, requires some solving techniques</li>
                    <li><strong>Hard</strong>: 20-25 initial numbers, challenging</li>
                </ul>

                <h3>Button Functions</h3>
                <ul>
                    <li><strong>Generate Sudoku</strong>: Creates a new puzzle based on selected difficulty</li>
                    <li><strong>Get Hint</strong>: Highlights the most suitable cell to fill and shows possible numbers</li>
                    <li><strong>Show Answer</strong>: Fills in the correct number in the highlighted cell</li>
                    <li><strong>Clear Board</strong>: Removes all filled numbers and starts over</li>
                </ul>

                <h3>How to Play</h3>
                <ul>
                    <li>Use mouse clicks or arrow keys for navigation</li>
                    <li>Input numbers 1-9 directly</li>
                    <li>Press Backspace to clear current cell</li>
                    <li>System automatically checks for completion</li>
                </ul>

                <h3>Draft Feature</h3>
                <ul>
                    <li><strong>âœ</strong>: Click to toggle Draft Mode</li>
                    <li>In Draft Mode, you can add multiple candidate numbers in cells</li>
                    <li>Click the draft button again to exit Draft Mode</li>
                    <li>Draft numbers don't affect game validation</li>
                </ul>

                <h3>Interface Controls</h3>
                <ul>
                    <li>ğŸŒ“: Toggle dark/light theme</li>
                    <li>ä¸­/En: Switch between Chinese/English</li>
                    <li>?: Show/hide help information</li>
                    <li>âœ: Toggle Draft Mode</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let board = Array(9).fill().map(() => Array(9).fill(0));
        let highlightedCell = null;
        let currentLanguage = 'zh';
        let solvedBoard = null;  // å­˜å‚¨å®Œæ•´è§£
        let isLocked = false;    // æ˜¯å¦é”å®šè¾“å…¥
        let initialCells = new Set();  // å­˜å‚¨åˆå§‹æ•°å­—çš„ä½ç½®
        
        // è¯­è¨€é…ç½®
        const translations = {
            zh: {
                noUniqueSolution: 'è¿™ä¸ªæ•°ç‹¬æ²¡æœ‰å”¯ä¸€è§£ï¼',
                completed: 'æ­å–œï¼æ•°ç‹¬å·²æ­£ç¡®å®Œæˆï¼',
                incorrect: 'æ•°ç‹¬å¡«å†™æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•ï¼',
                error: 'å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•',
                inputLocked: 'å·²é”å®šè¾“å…¥ã€‚å¦‚éœ€ä¿®æ”¹ï¼Œè¯·ç‚¹å‡»æ¸…ç©ºæ£‹ç›˜é‡æ–°å¼€å§‹ã€‚',
                generateError: 'ç”Ÿæˆæ•°ç‹¬æ—¶å‘ç”Ÿé”™è¯¯',
                draft: {
                    enter: "è¿›å…¥è‰ç¨¿æ¨¡å¼",
                    exit: "é€€å‡ºè‰ç¨¿æ¨¡å¼"
                }
            },
            en: {
                noUniqueSolution: 'This Sudoku has no unique solution!',
                completed: 'Congratulations! Sudoku completed correctly!',
                incorrect: 'The Sudoku is incorrect. Please check and try again!',
                error: 'An error occurred, please try again',
                inputLocked: 'Input is locked. To modify, please click Clear Board to start over.',
                generateError: 'Error generating Sudoku',
                draft: {
                    enter: "Enter Draft Mode",
                    exit: "Exit Draft Mode"
                }
            }
        };

        function toggleTheme() {
            document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', document.body.dataset.theme);
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'zh' ? 'en' : 'zh';
            document.querySelectorAll('.lang-zh').forEach(el => 
                el.style.display = currentLanguage === 'zh' ? '' : 'none'
            );
            document.querySelectorAll('.lang-en').forEach(el => 
                el.style.display = currentLanguage === 'en' ? '' : 'none'
            );
            localStorage.setItem('language', currentLanguage);
            
            // æ›´æ–°æ¶ˆæ¯å†…å®¹
            const messageDiv = document.getElementById('message');
            if (messageDiv.textContent) {
                translateMessage(messageDiv);
            }
        }

        function translateMessage(messageDiv) {
            // ç¿»è¯‘æç¤ºæ¶ˆæ¯
            Object.entries(translations[currentLanguage === 'zh' ? 'en' : 'zh']).forEach(([key, value]) => {
                if (messageDiv.textContent.includes(value)) {
                    messageDiv.textContent = messageDiv.textContent.replace(
                        value,
                        translations[currentLanguage][key]
                    );
                    return;
                }
            });
            
            // ç¿»è¯‘æ•°ç‹¬æç¤ºæ¶ˆæ¯
            if (currentLanguage === 'en') {
                messageDiv.textContent = messageDiv.textContent
                    .replace(/åœ¨?ç¬¬(\d+)è¡Œç¬¬(\d+)åˆ—/g, 'Row $1, Column $2')
                    .replace(/åªèƒ½å¡«å…¥æ•°å­—(\d+)/, 'can only be filled with number $1')
                    .replace(/å¯ä»¥å¡«å…¥çš„æ•°å­—æœ‰:/, 'Possible numbers are:');
            } else {
                messageDiv.textContent = messageDiv.textContent
                    .replace(/Row (\d+), Column (\d+)/g, 'ç¬¬$1è¡Œç¬¬$2åˆ—')
                    .replace(/can only be filled with number (\d+)/, 'åªèƒ½å¡«å…¥æ•°å­—$1')
                    .replace(/Possible numbers are:/, 'å¯ä»¥å¡«å…¥çš„æ•°å­—æœ‰:');
            }
        }

        // åˆå§‹åŒ–ä¸»é¢˜å’Œè¯­è¨€
        function initializeSettings() {
            // è®¾ç½®ä¸»é¢˜
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.dataset.theme = savedTheme;
            
            // è®¾ç½®è¯­è¨€
            const savedLanguage = localStorage.getItem('language') || 'zh';
            if (savedLanguage !== currentLanguage) {
                currentLanguage = savedLanguage;
                toggleLanguage();
            }
        }

        function updateGrid() {
            board.forEach((row, i) => {
                row.forEach((value, j) => {
                    const cell = document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);
                    if (cell) {
                        const mainNumber = cell.querySelector('.main-number');
                        if (mainNumber) {
                            mainNumber.textContent = value || '';
                        }
                        cell.classList.toggle('initial', initialCells.has(`${i},${j}`));
                    }
                });
            });
        }

        async function generateSudoku() {
            try {
                const gridLoading = document.getElementById('gridLoading');
                const generateButton = document.querySelector(`.lang-${currentLanguage}[onclick="generateSudoku()"]`);
                const gameButtons = document.querySelectorAll('.buttons button');
                const difficultySelects = document.querySelectorAll('#difficulty, #difficulty-en');
                
                if (gridLoading) {
                    gridLoading.style.display = 'flex';
                }
                
                if (generateButton) {
                    generateButton.innerHTML = currentLanguage === 'zh' ? 
                        'æ­£åœ¨ç”Ÿæˆ<span class="button-spinner"></span>' : 
                        'Generating<span class="button-spinner"></span>';
                }

                gameButtons.forEach(btn => btn.disabled = true);
                difficultySelects.forEach(select => select.disabled = true);

                const difficulty = document.getElementById(currentLanguage === 'zh' ? 'difficulty' : 'difficulty-en')?.value || 'medium';
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ difficulty: difficulty })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                if (data.success) {
                    board = data.board;
                    solvedBoard = data.solution;
                    initialCells.clear();
                    isLocked = false;
                    
                    // æ›´æ–°åˆå§‹å•å…ƒæ ¼é›†åˆ
                    board.forEach((row, i) => {
                        row.forEach((value, j) => {
                            if (value) {
                                initialCells.add(`${i},${j}`);
                            }
                        });
                    });
                    
                    // æ›´æ–°ç½‘æ ¼æ˜¾ç¤º
                    updateGrid();
                    clearHighlight();
                    
                    // æ¸…é™¤æ¶ˆæ¯
                    const messageDiv = document.getElementById('message');
                    if (messageDiv) {
                        messageDiv.textContent = '';
                        messageDiv.className = 'message';
                    }
                } else {
                    console.error('Generation failed:', data.message);
                    const messageDiv = document.getElementById('message');
                    if (messageDiv) {
                        messageDiv.className = 'message error';
                        messageDiv.textContent = data.message || translations[currentLanguage].generateError;
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                const messageDiv = document.getElementById('message');
                if (messageDiv) {
                    messageDiv.className = 'message error';
                    messageDiv.textContent = translations[currentLanguage].generateError + (error.message ? `: ${error.message}` : '');
                }
            } finally {
                const gridLoading = document.getElementById('gridLoading');
                const generateButton = document.querySelector(`.lang-${currentLanguage}[onclick="generateSudoku()"]`);
                const gameButtons = document.querySelectorAll('.buttons button');
                const difficultySelects = document.querySelectorAll('#difficulty, #difficulty-en');
                
                if (gridLoading) {
                    gridLoading.style.display = 'none';
                }
                
                if (generateButton) {
                    generateButton.innerHTML = currentLanguage === 'zh' ? 'ç”Ÿæˆæ•°ç‹¬' : 'Generate Sudoku';
                }
                
                gameButtons.forEach(btn => btn.disabled = false);
                difficultySelects.forEach(select => select.disabled = false);
            }
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';  // æ¸…ç©ºç°æœ‰å†…å®¹
            
            for (let i = 0; i < 9; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                
                for (let j = 0; j < 9; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    if (j === 2 || j === 5) cell.className += ' grid-line-right';
                    if (i === 2 || i === 5) cell.className += ' grid-line-bottom';

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.maxLength = 1;
                    input.dataset.row = i;
                    input.dataset.col = j;
                    
                    input.addEventListener('input', (e) => {
                        if (isLocked || initialCells.has(`${i},${j}`)) {
                            e.preventDefault();
                            e.target.value = board[i][j] || '';
                            const messageDiv = document.getElementById('message');
                            messageDiv.className = 'message error';
                            messageDiv.textContent = translations[currentLanguage].inputLocked;
                            return;
                        }
                        
                        const value = e.target.value;
                        if (value === '0') {
                            e.target.value = '';
                            board[i][j] = 0;
                            moveToNextCell(i, j);
                            checkCompletion();
                        } else if (value && (isNaN(value) || value < 0 || value > 9)) {
                            e.target.value = '';
                        } else {
                            board[i][j] = value ? parseInt(value) : 0;
                            if (value) {
                                moveToNextCell(i, j);
                            }
                            checkCompletion();
                        }
                    });

                    input.addEventListener('keydown', (e) => {
                        const row = parseInt(e.target.dataset.row);
                        const col = parseInt(e.target.dataset.col);
                        
                        switch(e.key) {
                            case 'ArrowUp':
                                moveFocus(row - 1, col);
                                e.preventDefault();
                                break;
                            case 'ArrowDown':
                                moveFocus(row + 1, col);
                                e.preventDefault();
                                break;
                            case 'ArrowLeft':
                                moveFocus(row, col - 1);
                                e.preventDefault();
                                break;
                            case 'ArrowRight':
                                moveFocus(row, col + 1);
                                e.preventDefault();
                                break;
                            case ' ':
                                moveToNextCell(row, col);
                                e.preventDefault();
                                break;
                            case 'Backspace':
                                if (!e.target.value) {
                                    moveToPrevCell(row, col);
                                    e.preventDefault();
                                }
                                break;
                        }
                    });
                    
                    cell.appendChild(input);
                    row.appendChild(cell);
                }
                grid.appendChild(row);
            }
            updateGrid();
        }

        function moveToNextCell(currentRow, currentCol) {
            let nextRow = currentRow;
            let nextCol = currentCol + 1;
            
            if (nextCol >= 9) {
                nextCol = 0;
                nextRow++;
            }
            if (nextRow < 9) {
                moveFocus(nextRow, nextCol);
            }
        }

        function moveToPrevCell(currentRow, currentCol) {
            let prevRow = currentRow;
            let prevCol = currentCol - 1;
            
            while (prevRow >= 0) {
                while (prevCol >= 0) {
                    const input = document.querySelector(`[data-row="${prevRow}"][data-col="${prevCol}"]`);
                    if (input && !input.disabled) {
                        input.focus();
                        return;
                    }
                    prevCol--;
                }
                prevRow--;
                prevCol = 8;
            }
        }

        function moveFocus(row, col) {
            if (row >= 0 && row < 9 && col >= 0 && col < 9) {
                const nextInput = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                if (nextInput && !nextInput.disabled) {
                    nextInput.focus();
                } else {
                    // å¦‚æœä¸‹ä¸€ä¸ªæ ¼å­è¢«ç¦ç”¨ï¼Œç»§ç»­å¯»æ‰¾ä¸‹ä¸€ä¸ªå¯ç”¨çš„æ ¼å­
                    let nextRow = row;
                    let nextCol = col;
                    while (nextRow < 9) {
                        while (nextCol < 9) {
                            const input = document.querySelector(`[data-row="${nextRow}"][data-col="${nextCol}"]`);
                            if (input && !input.disabled) {
                                input.focus();
                                return;
                            }
                            nextCol++;
                        }
                        nextRow++;
                        nextCol = 0;
                    }
                }
            }
        }

        function clearHighlight() {
            if (highlightedCell) {
                highlightedCell.classList.remove('highlighted');
                highlightedCell = null;
            }
        }

        function highlightCell(row, col) {
            clearHighlight();
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            if (cell) {
                cell.classList.add('highlighted');
                highlightedCell = cell;
            }
        }

        async function getHint() {
            try {
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ ¼å­éƒ½å·²å¡«å†™
                let isFull = true;
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        if (board[i][j] === 0) {
                            isFull = false;
                            break;
                        }
                    }
                    if (!isFull) break;
                }

                if (isFull) {
                    // å¦‚æœå·²å¡«æ»¡ï¼Œæ£€æŸ¥æ˜¯å¦æ­£ç¡®
                    const messageDiv = document.getElementById('message');
                    clearHighlight();
                    
                    let isCorrect = true;
                    if (solvedBoard) {
                        for (let i = 0; i < 9; i++) {
                            for (let j = 0; j < 9; j++) {
                                if (board[i][j] !== solvedBoard[i][j]) {
                                    isCorrect = false;
                                    break;
                                }
                            }
                            if (!isCorrect) break;
                        }
                    } else {
                        // å¦‚æœæ²¡æœ‰è§£å†³æ–¹æ¡ˆï¼Œæ£€æŸ¥åŸºæœ¬è§„åˆ™
                        isCorrect = checkBasicRules();
                    }
                    
                    messageDiv.className = isCorrect ? 'message success' : 'message error';
                    messageDiv.textContent = isCorrect ? 
                        translations[currentLanguage].completed : 
                        translations[currentLanguage].incorrect;
                    return;
                }

                // å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨è·å–æ™ºèƒ½æç¤º
                const response = await fetch('/get_hint', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        board: board,
                        solved_board: solvedBoard // å¯é€‰ï¼Œå¦‚æœæœ‰å®Œæ•´è§£å†³æ–¹æ¡ˆ
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const messageDiv = document.getElementById('message');
                
                if (data.success) {
                    messageDiv.className = 'message success';
                    if (data.row !== undefined && data.col !== undefined) {
                        highlightCell(data.row, data.col);
                        
                        // å¦‚æœæ‰¾åˆ°å”¯ä¸€å¯èƒ½çš„æ•°å­—
                        if (data.number) {
                            messageDiv.textContent = currentLanguage === 'zh' ? 
                                `ç¬¬${data.row + 1}è¡Œç¬¬${data.col + 1}åˆ—åªèƒ½å¡«å…¥æ•°å­—${data.number}` :
                                `Row ${data.row + 1}, Column ${data.col + 1} can only be filled with number ${data.number}`;
                        } 
                        // å¦‚æœæœ‰å¤šä¸ªå¯èƒ½çš„æ•°å­—
                        else if (data.possible_numbers && data.possible_numbers.length > 0) {
                            // å¦‚æœè¿™æ˜¯æœ€å°‘å¯èƒ½æ€§çš„æ ¼å­
                            if (data.is_minimal) {
                                messageDiv.textContent = currentLanguage === 'zh' ? 
                                    `æç¤ºï¼šç¬¬${data.row + 1}è¡Œç¬¬${data.col + 1}åˆ—æ˜¯å¯èƒ½æ€§æœ€å°‘çš„æ ¼å­ï¼Œå¯ä»¥å¡«å…¥çš„æ•°å­—æœ‰ï¼š${data.possible_numbers.join(', ')}` :
                                    `Hint: Row ${data.row + 1}, Column ${data.col + 1} has the least possibilities: ${data.possible_numbers.join(', ')}`;
                            } else {
                                messageDiv.textContent = currentLanguage === 'zh' ? 
                                    `ç¬¬${data.row + 1}è¡Œç¬¬${data.col + 1}åˆ—å¯ä»¥å¡«å…¥çš„æ•°å­—æœ‰ï¼š${data.possible_numbers.join(', ')}` :
                                    `Row ${data.row + 1}, Column ${data.col + 1} possible numbers are: ${data.possible_numbers.join(', ')}`;
                            }
                        }
                    }
                } else {
                    messageDiv.className = 'message error';
                    messageDiv.textContent = data.message || translations[currentLanguage].noUniqueSolution;
                    clearHighlight();
                }
            } catch (error) {
                console.error('Error:', error);
                const messageDiv = document.getElementById('message');
                messageDiv.className = 'message error';
                messageDiv.textContent = translations[currentLanguage].error;
            }
        }

        // æ£€æŸ¥æ•°ç‹¬åŸºæœ¬è§„åˆ™
        function checkBasicRules() {
            // æ£€æŸ¥è¡Œ
            for (let i = 0; i < 9; i++) {
                let row = new Set();
                for (let j = 0; j < 9; j++) {
                    if (row.has(board[i][j])) return false;
                    row.add(board[i][j]);
                }
            }
            
            // æ£€æŸ¥åˆ—
            for (let j = 0; j < 9; j++) {
                let col = new Set();
                for (let i = 0; i < 9; i++) {
                    if (col.has(board[i][j])) return false;
                    col.add(board[i][j]);
                }
            }
            
            // æ£€æŸ¥3x3æ–¹æ ¼
            for (let block = 0; block < 9; block++) {
                let square = new Set();
                let startRow = Math.floor(block / 3) * 3;
                let startCol = (block % 3) * 3;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        let num = board[startRow + i][startCol + j];
                        if (square.has(num)) return false;
                        square.add(num);
                    }
                }
            }
            
            return true;
        }

        async function showAnswer() {
            if (!highlightedCell) {
                await getHint();
                return;
            }

            const row = parseInt(highlightedCell.dataset.row);
            const col = parseInt(highlightedCell.dataset.col);
            
            if (solvedBoard && solvedBoard[row] && solvedBoard[row][col]) {
                const number = solvedBoard[row][col];
                board[row][col] = number;
                updateGrid();
                
                // æ ‡è®°ä¸ºåˆå§‹å•å…ƒæ ¼
                initialCells.add(`${row},${col}`);
                
                // æ¸…é™¤è¯¥å•å…ƒæ ¼çš„è‰ç¨¿æ•°å­—
                await fetch('/clear_draft', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        row: row,
                        col: col,
                        board: board
                    })
                });
                
                // å¯»æ‰¾ä¸‹ä¸€ä¸ªéœ€è¦æç¤ºçš„å•å…ƒæ ¼
                await getHint();
            }
        }

        function clearBoard() {
            board = Array(9).fill().map(() => Array(9).fill(0));
            solvedBoard = null;
            isLocked = false;
            initialCells.clear();
            clearHighlight();
            updateGrid();
            // æ¸…é™¤æç¤ºä¿¡æ¯
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = '';
            messageDiv.className = 'message';
            messageDiv.dataset.number = '';
            messageDiv.dataset.possibleNumbers = '';
        }

        function checkCompletion() {
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ ¼å­éƒ½å·²å¡«å†™
            let isFull = true;
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (board[i][j] === 0) {
                        isFull = false;
                        break;
                    }
                }
            }

            if (isFull) {
                // æ£€æŸ¥æ˜¯å¦æ­£ç¡®
                let isCorrect = true;
                // æ£€æŸ¥æ¯ä¸€è¡Œ
                for (let i = 0; i < 9; i++) {
                    let row = new Set();
                    for (let j = 0; j < 9; j++) {
                        if (row.has(board[i][j])) {
                            isCorrect = false;
                            break;
                        }
                        row.add(board[i][j]);
                    }
                }
                // æ£€æŸ¥æ¯ä¸€åˆ—
                for (let j = 0; j < 9; j++) {
                    let col = new Set();
                    for (let i = 0; i < 9; i++) {
                        if (col.has(board[i][j])) {
                            isCorrect = false;
                            break;
                        }
                        col.add(board[i][j]);
                    }
                }
                // æ£€æŸ¥æ¯ä¸ª3x3æ–¹æ ¼
                for (let block = 0; block < 9; block++) {
                    let square = new Set();
                    let startRow = Math.floor(block / 3) * 3;
                    let startCol = (block % 3) * 3;
                    for (let i = 0; i < 3; i++) {
                        for (let j = 0; j < 3; j++) {
                            let num = board[startRow + i][startCol + j];
                            if (square.has(num)) {
                                isCorrect = false;
                                break;
                            }
                            square.add(num);
                        }
                    }
                }

                const messageDiv = document.getElementById('message');
                if (isCorrect) {
                    messageDiv.textContent = translations[currentLanguage].completed;
                    messageDiv.className = 'message success';
                } else {
                    messageDiv.textContent = translations[currentLanguage].incorrect;
                    messageDiv.className = 'message error';
                }
            }
        }

        function updateCell(row, col, value) {
            if (isLocked && !initialCells.has(`${row},${col}`)) {
                showMessage(translations[currentLanguage].inputLocked, 'error');
                return;
            }
            
            const num = parseInt(value) || 0;
            if (num >= 0 && num <= 9) {
                board[row][col] = num;
                updateGrid();
                // æ¯æ¬¡æ›´æ–°å•å…ƒæ ¼åæ£€æŸ¥æ˜¯å¦å®Œæˆ
                checkCompletion();
            }
        }

        function toggleHelp() {
            const modal = document.getElementById('helpModal');
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
            } else {
                modal.style.display = 'block';
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨æ—¶å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('helpModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // å…¨å±€å˜é‡
        let currentLang = 'zh';
        let isDraftMode = false;
        let selectedCell = null;

        // DOM å…ƒç´ 
        const draftToggle = document.getElementById('draftToggle');
        const messageDiv = document.getElementById('message');
        const grid = document.querySelector('.grid');

        // åˆå§‹åŒ–å‡½æ•°
        function initializeGame() {
            // ... existing initialization code ...
            
            // è®¾ç½®è‰ç¨¿æ¨¡å¼æŒ‰é’®
            draftToggle.title = translations[currentLang].draft.enter;
            
            // åˆå§‹åŒ–æ ¼å­äº‹ä»¶ç›‘å¬å™¨
            initializeCellListeners();
        }

        // åˆ‡æ¢è‰ç¨¿æ¨¡å¼
        draftToggle.addEventListener('click', () => {
            isDraftMode = !isDraftMode;
            document.body.classList.toggle('draft-mode', isDraftMode);
            draftToggle.classList.toggle('active', isDraftMode);
            draftToggle.title = translations[currentLang].draft[isDraftMode ? 'exit' : 'enter'];
            
            // æ˜¾ç¤ºè‰ç¨¿æ¨¡å¼çŠ¶æ€æç¤º
            showMessage(
                currentLang === 'zh' ? 
                    (isDraftMode ? 'å·²è¿›å…¥è‰ç¨¿æ¨¡å¼ï¼Œå¯ä»¥åœ¨æ ¼å­ä¸­æ·»åŠ å¤šä¸ªæ•°å­—' : 'å·²é€€å‡ºè‰ç¨¿æ¨¡å¼') :
                    (isDraftMode ? 'Entered Draft Mode, you can add multiple numbers in cells' : 'Exited Draft Mode'),
                'success'
            );
        });

        // å¤„ç†é”®ç›˜è¾“å…¥
        document.addEventListener('keydown', async (e) => {
            if (!selectedCell) return;
            
            const row = parseInt(selectedCell.dataset.row);
            const col = parseInt(selectedCell.dataset.col);
            
            if (e.key >= '1' && e.key <= '9') {
                const num = parseInt(e.key);
                if (isDraftMode) {
                    // åœ¨è‰ç¨¿æ¨¡å¼ä¸‹å¤„ç†è¾“å…¥
                    if (!isInitialCell(row, col)) {
                        const response = await fetch('/add_draft', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                row: row,
                                col: col,
                                number: num,
                                board: board
                            })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                updateDraftNumbers(row, col, data.draft_numbers);
                            }
                        }
                    }
                } else {
                    // åœ¨æ­£å¸¸æ¨¡å¼ä¸‹å¤„ç†è¾“å…¥
                    if (!isInitialCell(row, col)) {
                        board[row][col] = num;
                        // æ¸…é™¤è¯¥æ ¼å­çš„è‰ç¨¿æ•°å­—
                        await fetch('/clear_draft', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                row: row,
                                col: col,
                                board: board
                            })
                        });
                        updateCell(row, col);
                    }
                }
            } else if (e.key === 'Backspace' || e.key === 'Delete') {
                if (!isInitialCell(row, col)) {
                    if (isDraftMode) {
                        // åœ¨è‰ç¨¿æ¨¡å¼ä¸‹æ¸…é™¤æ‰€æœ‰è‰ç¨¿æ•°å­—
                        const response = await fetch('/clear_draft', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                row: row,
                                col: col,
                                board: board
                            })
                        });
                        
                        if (response.ok) {
                            updateDraftNumbers(row, col, []);
                        }
                    } else {
                        // åœ¨æ­£å¸¸æ¨¡å¼ä¸‹æ¸…é™¤æ•°å­—
                        board[row][col] = 0;
                        updateCell(row, col);
                    }
                }
            }
        });

        // æ›´æ–°è‰ç¨¿æ•°å­—æ˜¾ç¤º
        function updateDraftNumbers(row, col, numbers) {
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            if (cell) {
                const draftCells = cell.querySelectorAll('.draft-number');
                draftCells.forEach((draftCell, index) => {
                    draftCell.textContent = numbers.includes(index + 1) ? (index + 1) : '';
                });
            }
        }

        // æ›´æ–°å•ä¸ªæ ¼å­æ˜¾ç¤º
        function updateCell(row, col) {
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            if (cell) {
                const mainNumber = cell.querySelector('.main-number');
                mainNumber.textContent = board[row][col] || '';
            }
        }

        // æ£€æŸ¥æ˜¯å¦ä¸ºåˆå§‹æ ¼å­
        function isInitialCell(row, col) {
            return initialCells.has(`${row},${col}`);
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = 'info') {
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            setTimeout(() => {
                messageDiv.className = 'message';
                messageDiv.textContent = '';
            }, 3000);
        }

        // æ·»åŠ å•å…ƒæ ¼ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('grid');
            if (grid) {
                grid.addEventListener('click', (e) => {
                    const cell = e.target.closest('.cell');
                    if (cell) {
                        // ç§»é™¤ä¹‹å‰é€‰ä¸­çš„å•å…ƒæ ¼é«˜äº®
                        const previousSelected = document.querySelector('.cell.selected');
                        if (previousSelected) {
                            previousSelected.classList.remove('selected');
                        }
                        
                        // é«˜äº®å½“å‰é€‰ä¸­çš„å•å…ƒæ ¼
                        cell.classList.add('selected');
                        selectedCell = cell;
                    }
                });
            }
        });

        // æ·»åŠ é€‰ä¸­å•å…ƒæ ¼çš„æ ·å¼
        const styleSheet = document.createElement('style');
        styleSheet.textContent = `
            .cell.selected {
                background-color: var(--highlight-bg);
            }
        `;
        document.head.appendChild(styleSheet);

        // åˆå§‹åŒ–
        initializeGame();
    </script>
</body>
</html> 